resources:
  - name: Trigger_Demo_resource
    type: PropertyBag
    configuration:
      version: 0

pipelines:
  - name: TRIGGER_DEMO
    configuration:
      environmentVariables:
        readOnly:
          EXIT_CODE: 1
          DEPLOY_CODE: 1
    steps:
      - name: build
        type: Bash
        execution:
          onExecute:
            - write_output Trigger_Demo_resource "version=$run_id"
        configuration:
          outputResources:
            - name: Trigger_Demo_resource
      - name: test
        type: Bash
        configuration:
          inputSteps:
            - name: build
          inputResources:
            - name: Trigger_Demo_resource
        execution:
          onExecute:
            - echo $EXIT_CODE
            - exit $EXIT_CODE
      - name: deploy
        type: Bash
        configuration:
          inputResources:
            - name: Trigger_Demo_resource
          inputSteps:
            - name: test
        execution:
          onExecute:
            - echo deploying version $res_Trigger_Demo_resource_version
            - exit $DEPLOY_CODE
